<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<html lang="en">
<!--<![endif]-->

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">

    <title>QStream - Documentation</title>

    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="css/stroke.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="css/animate.css">
    <link rel="stylesheet" type="text/css" href="css/prettyPhoto.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">

    <link rel="stylesheet" type="text/css" href="js/syntax-highlighter/styles/shCore.css" media="all">
    <link rel="stylesheet" type="text/css" href="js/syntax-highlighter/styles/shThemeRDark.css" media="all">

    <!-- CUSTOM -->
    <link rel="stylesheet" type="text/css" href="css/custom.css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <div id="wrapper">

        <div class="container">

            <section id="top" class="section docs-heading">

                <div class="row">
                    <div class="col-md-12">
                        <div class="big-title text-center">
                            <h1>QStream : Extension QGis pour Stream</h1>
                            <p class="lead">Documentation technique Version 0.1</p>
                            <div class="intro2 clearfix">
                                <p><i class="fa fa-exclamation-triangle"></i> ATTENTION : La version actuelle de la documentation n'est pas définitive. Elle peut être incomplète où présenter des erreurs. Merci de nous faire part de vos suggestions.
                                </p>
                            </div>
                        </div>
                        <!-- end title -->
                    </div>
                    <!-- end 12 -->
                </div>
                <!-- end row -->

                <hr>

            </section>
            <!-- end section -->

            <div class="row">

                <div class="col-md-3">
                    <nav class="docs-sidebar" data-spy="affix" data-offset-top="300" data-offset-bottom="200" role="navigation">
                        <ul class="nav">
                            <li><a href="#line1">Réaliser une étude</a></li>
                            <li><a href="#line2">Questions Diverses</a></li>
                            <ul class="nav">
                                <li><a href="#line3_1">Installer un package python tier</a></li>
                            </ul>
                        </ul>
                    </nav >
                </div>
                <div class="col-md-9">
                    <section class="welcome">

                        <div class="row">
                            <div class="col-md-12 left-align">
                                <h2 class="dark-text">Introduction<hr></h2>
                                <div class="row">

                                    <div class="col-md-12 full">
                                        <div class="intro1">
                                            <ul>
                                                <li><strong>Nom : </strong>QStream - Interface QGis pour Stream</li>
                                                <li><strong>Version : </strong> v 0.0.3</li>
                                                <li><strong>Auteurs : </strong> Aurélien CLAIRAIS, Etienne HANS</li>
                                                <li><strong>Service : </strong> CEREMA Centre-Est</li>
                                                <li><strong>Contact : </strong> <a href="mailto:aurelien.clairais@cerema.fr" target="_blank">aurelien.clairais@cerema.fr</a></li>
                                            </ul>
                                        </div>

                                        <hr>
                                        <div>
                                            <p><strong>Stream</strong> est une plateforme de simulation mésoscopique du trafic.
                                                Développée initaliement sur MatLab, puis reprise entierrement en Python, elle se dote aujourd'hui d'une plateforme de conception de scénarios.
                                                Ainsi, <strong>QStream</strong> est une extension de QGis permettant la création de scénarios pour Stream.
                                                Les fonctionnalitées de QGis permettent la création du réseau (liens, noeuds), le paramétrage des scénarios (offre, demande), l'ajout de régulations.
                                                L'interface avec Stream permet la simulation du scénario et l'analyse des résultats.
                                            </p>

                                            <p>Cette documentation présente les fonctionnalitées de QStream et propose de guider l'utilisateur dans le but de mener à bien une simulation mésoscopique du trafic.
                                                L'utilisation de l'outils ne nécessite aucun pré-requis particulier en termes de compétences.
                                                En effet, l'ensemble des démarches présentées sont détaillées dans un but d'accessibilité au plus grand nombre.
                                                En cas d'incompréhension, la dernière partie regroupe des questions diverses.
                                                Sinon, contacter ...
                                            </p>

                                            <h4>Pré-requis</h4>
                                            <p>Afin de pouvoir utiliser correctement <strong>QStream</strong> vous devez disposer de :</p>
                                            <ol>
                                                <li>Windows et QGis version 3.4 minimum ;</li>
                                                <li>Les packages <kbd>pyexcel_ods</kbd> et <kbd>matplotlib</kbd> installés dans la version de Python de QGis ; <a href="#line3_1"><i class="fa fa-question-circle" aria-hidden="true"></i></a></li>
                                                <li>Afin d'effectuer des simulations et des analyses : <strong>Stream Python</strong></li>
                                            </ol>

                                        </div>
                                    </div>

                                </div>
                                <!-- end row -->
                            </div>
                        </div>
                    </section>

                    <section id="line1" class="section">

                        <div class="row">
                            <div class="col-md-12 left-align">
                                <h2 class="dark-text">Réaliser une étude pas à pas<a href="#top"><i class="fa fa-arrow-circle-up fa-3x" aria-hidden="true"></i>
</a><hr></h2>
                            </div>
                            <!-- end col -->
                        </div>
                        <!-- end row -->

                        <div class="row">
                            <div class="col-md-12">
                                <!-- tuto MED -->
                                <h4> Lancement </h4>
                                <p>
                                    Ouvrir QGis 3.4. Inastaller le plugin si nécessaire depuis un fichier ".zip" fourni.<br>
                                    <img class='fit' src="images/01_instalation_plugin.png" alt=""></img><br>
                                    Ouvrir le module Qstream.<br>
                                    <img class='fit' src="images/02_plugin.png" alt=""><br>
                                    Activer les options d'accrochage : <br>
                                    Projet > Options d'accrochage > Activer les options - mètres > Fermer<br>
                                    <img class='fit' src="images/03_option_accrochage.png" alt=""><br>
                                </p>

                                <h4> Démarrage d'un nouveau réseau</h4>
                                <p>
                                    Importer le fond de plan OpenStreetMap.
                                    <img class='fit' src="images/04_fond_de_plan.png" alt=""></img><br>
                                    Zoomer sur la partie de la carte où se trouve le réseau d'intérêt.<br>
                                    Cliquer sur l'icône de création d'un nouveau projet.<br>
                                    Créer un nouveau dossier > Donner le nom de votre réseau > Enregistrer.<br>
                                    <img class='fit' src="images/05_nouveau_scenario.png" alt=""></img><br>
                                </p>

                                <h4> Paramétrage du réseau </h4>
                                <p>
                                    Cliquer sur l'icône de modification des propriétés des liens.<br>
                                    <img class='fit' src="images/06_proprietes_liens.png" alt=""></img><br>
                                    Ajouter un type de route, par exemple un type "Bretelle".<br>
                                    Proposer des valeurs par défaut pour ce nouveau type.<br>
                                    Modifier type > valider les changements globaux.<br>
                                    Cliquer sur l'icône d'enregistrement des modifications.<br>
                                </p>

                                <p>
                                    <strong>Edition de la géométrie des liens.</strong><br>
                                    Cliquer sur l'icône d'ajout de lien.<br>
                                    <img class='fit' src="images/07_edition_lien.png" alt=""></img><br>
                                    Editer un lien en cliquant sur la carte : des clics gauches pour faire une polyligne, un clic droit pour terminer l'édition.<br>
                                    Il est possible de compléter les attributs soit une fois le lien édité (possible mais long), soit plus tard (conseillé).<br>
                                    Une fois tous les liens édités, cliquer sur l'icône d'enregistrement des modifications<br>
                                    <img class='fit' src="images/08_edition_reseau.png" alt=""></img><br>
                                </p>

                                <p>
                                    <strong>Edition des paramètres des liens</strong><br>
                                    Cliquer sur la couche "Liens".<br>
                                    Si besoin, la basculer en mode édition.<br>
                                    Ouvrir la table des attributs.<br>
                                    <img class='fit' src="images/09_table_attributs_liens.png" alt=""></img><br>
                                </p>
                                Compléter les paramètes des liens si besoin (road_type, num_lanes, speed)<br>
                                <img class='fit' src="images/10_attributs_remplis.png" alt=""></img><br>

                                <p>
                                    <strong>Création des noeuds</strong><br>
                                    Cliquer sur l'icône de création des noeuds<br>
                                    Basculer les noeuds en mode édition<br>
                                    Cliquer sur l'icone "identifier les entités" (ou ctrl+Maj+J)<br>
                                    Cliquer sur les noeuds, en particulier d'entrée et sortie > modifier leurs "name".<br>
                                    <img class='fit' src="images/11_creation_noeuds.png" alt=""></img><br>
                                </p>

                                <p>
                                    <strong>Modifier les paramètres généraux (icône 2:2)</strong><br>
                                    <img class='fit' src="images/12_parametres_generaux.png" alt=""></img><br>
                                    Conserver le paramètre ActiveUpstreamCapacity désactivé.<br>
                                    Choisir l'emplacement des codes Stream ("Stream_Vx.x.x" et non le sous-dossier "stream")<br>
                                    Cliquer sur "ok"<br>
                                </p>

                                <p>
                                    <strong>Les types de vehicules doivent toujours être identifiés à partir de 0 et sans saut dans leurs identifiants</strong><br>
                                    Ouvrir la table VehicleTypes<br>
                                    Ajouter au besoin un type de véhicule<br>
                                    <img class='fit' src="images/13_types_vehicules.png" alt=""></img><br>
                                </p>

                                <h4>Gestion de la demande</h4>
                                <p>
                                    Cliquer sur Générer une demande.<br>
                                    Ouvrir le dossier du scénario.<br>
                                    Renommer le tableur OD_matrix.ods
                                    <img class='fit' src="images/14_generation_matrice_OD.png" alt=""></img><br>
                                    Ouvrir le tableur nom_OD_matrix.ods de la demande avec LibreOffice (pas Excel).<br>
                                    Remplir le tableur : des entiers, en véhicules par heure (référence : capacité environ 2000 veh/h par voie).<br>
                                    Remplir toutes les cases.<br>
                                    <img class='fit' src="images/15_remplissage_matrice_OD.png" alt=""></img><br>
                                    Enregistrer le tableur.<br>
                                    Cliquer dans Qgis sur Importer la matrice.<br>
                                    <img class='fit' src="images/16_import_matrice_OD.png" alt=""></img><br>
                                </p>

                                <h4>Simulation et Analyse</h4>
                                <p>
                                    <strong>Lancer la simulation (icône 2:3).</strong><br>
                                    <img class='fit' src="images/18_lancement_simulation.png" alt=""></img><br>
                                </p>

                                <p>
                                Aller dans le menu Analyse.<br>
                                Afficher le réseau.<br>
                                <img class='fit' src="images/19_figure.png" alt=""></img><br>
                                Cliquer sur la couche des Liens, et en sélectionner, pour voir les temps de parcours par lien.<br>
                                <img class='fit' src="images/20_figure_tp_liens.png" alt=""></img><br>
                                Cliquer sur la couche des noeuds, et en sélectionner, pour voir les temps de parcours par itinéraire.<br>
                                "Générer des fichiers XT".<br>
                                Cliquer sur la couche des Liens, et en sélectionner, pour voir les diagrammes espace temps.<br>
                                Cliquer sur "Traficolor" pour le traficolor dynamique.<br>
                                </p>
                        </div>
                    </div>

                    </section>
                    <!-- end section -->


                    <section id="line2 class="section">

                        <div class="row">
                            <div class="col-md-12 left-align">
                                <h2 class="dark-text">Questions Diverses<a href="#top"><i class="fa fa-arrow-circle-up fa-3x" aria-hidden="true"></i></a><hr></h2>
                            </div>
                            <!-- end col -->
                        </div>
                        <!-- end row -->

                        <div class="row">

                            <div class="col-md-12">
                                <p>Cette section regroupe des questions diverses référencées ou non dans les autres parties.</p>
                            </div>
                        </div>
                        <!-- end row -->
                        <div class="row">
                            <div class="col-md-12">
                                <h4 id="line3_1">Installer un package python tier</h4>
                                <p>
                                    Certaines fonctionnalitées de <strong>QStream</strong> nécessite l'installation de package tiers.
                                    En l'absence de moyen pour installer automatiquement ces packages, il faut installer ces packages via pip.
                                    Les étapes sont les suivantes :
                                </p>
                                    <ol>
                                        <li>Localiser et lancer le batch d'<strong>OSGeo4W</strong> ;</li>
                                    <p>
                                        Cette invite de commande se trouve à la racine du dossier d'installation de <strong>OSGeo4W</strong>.
                                        Pour une installation windows, classique, le chemin d'accès est le suivant : </br>
                                        <code>
                                            C:\OSGeo4W\OSGeo4W.bat
                                        </code>
                                    </p>
                                    <li>Activer les chemins d'accès de Python 3 et Qt5 dans l'invite de commande ;</li>
                                <p>
                                    Dans l'invite de commande, tapez la commande :</br>
                                    <code>
                                        py3_env
                                    </code></br>
                                    Cette commande met à jour le chemin d'accès vers l'executable Python de QGis. Ensuite, tapez la commande :
                                    </br>
                                    <code>
                                        qt5_env
                                    </code></br>
                                    Cette commande met à jour le chemin d'accès vers les fichiers de Qt, gestionnaires d'interfaces IHM.
                                </p>

                                    <li>Installer le package tier ;</li>
                                <p>
                                    Dans l'invite de commande, faites appel à pip pour l'installation du package tier :</br>
                                    <code>
                                        pip install [nom du package]
                                    </code></br>
                                    Plus particulièrement, vous pouvez ainsi installer les prérequis pour QStream :
                                    </br>
                                    <code>
                                        pip install pyexcel_ods, matplotlib
                                    </code></br>
                                </p>
                                    </ol>

                                <!-- end col -->

                            </div>
                        </div>
                        <!-- end row -->



                    </section>
                    <!-- end section -->



                </div>
                <!-- // end .col -->

            </div>
            <!-- // end .row -->

        </div>
        <!-- // end container -->

    </div>
    <!-- end wrapper -->

    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/retina.js"></script>
    <script src="js/jquery.fitvids.js"></script>
    <script src="js/wow.js"></script>
    <script src="js/jquery.prettyPhoto.js"></script>

    <!-- CUSTOM PLUGINS -->
    <script src="js/custom.js"></script>
    <script src="js/main.js"></script>

    <script src="js/syntax-highlighter/scripts/shCore.js"></script>
    <script src="js/syntax-highlighter/scripts/shBrushXml.js"></script>
    <script src="js/syntax-highlighter/scripts/shBrushCss.js"></script>
    <script src="js/syntax-highlighter/scripts/shBrushJScript.js"></script>

</body>

</html>
